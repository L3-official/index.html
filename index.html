<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>L3会員証</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background: #f9f9f9; padding-top: 50px; }
        .card { background: white; border-radius: 20px; padding: 30px; margin: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        #days-left { font-size: 80px; color: #ff4757; font-weight: bold; }
        .unit { font-size: 20px; color: #555; }
   /* プロフィールカードのデザイン */
    .member-card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        margin: 15px auto;
        width: 90%;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        text-align: left;
    }
    .member-card h4 { margin: 0 0 10px 0; color: #333; border-bottom: 2px solid #ff4757; display: inline-block; }
    .member-info { font-size: 14px; color: #555; line-height: 1.6; }
    .member-info b { color: #ff4757; }
    #member-list-section { margin-top: 40px; padding-bottom: 50px; }
    </style>
</head>
<body>
    <div class="card">
        <button onclick="showMemberList()" style="margin-top: 20px; padding: 12px 25px; font-size: 16px; border-radius: 25px; background: #007bff; color: white; border: none; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        部員名簿を表示する
    </button>

    <div id="member-list-section" style="display: none;">
        <h2 style="color: #333;">L3 部員名簿</h2>
        <div id="member-cards"></div>
    </div>
        <h2>卒業（引退）まであと</h2>
        <div id="days-left">--</div>
        <div class="unit">日</div>
        <p id="graduation-date" style="color: #888; margin-top: 20px;">読み込み中...</p>
    </div>

    <script>
        // あなたが発行したGASのURL
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzzFop7PyprYHBZEMVCCA3OU2kXMehSkXbHdYmUCTo2lR67eXxK_2K4G5DFsBJWKTdDdw/exec";

        async function initLIFF() {
            await liff.init({ liffId: "2008760618-igOldYtb" });
            if (!liff.isLoggedIn()) {
                liff.login();
            } else {
                const profile = await liff.getProfile();
                fetchData(profile.userId);
            }
        }

        async function fetchData(userId) {
            const response = await fetch(`${GAS_URL}?id=${userId}`);
            const data = await response.json();
            if (data.status !== 'not_found') {
                const gradDate = new Date(data.graduationDate);
                const diff = Math.ceil((gradDate - new Date()) / (1000 * 60 * 60 * 24));
                document.getElementById('days-left').innerText = diff;
                document.getElementById('graduation-date').innerText = "卒業予定日: " + gradDate.toLocaleDateString();
            } else {
                document.getElementById('days-left').innerText = "？";
                document.getElementById('graduation-date').innerText = "データが見つかりません";
            }
        }
        initLIFF();
        async function showMemberList() {
    const section = document.getElementById('member-list-section');
    const container = document.getElementById('member-cards');
    
    // ボタンを押したら名簿エリアを表示
    section.style.display = 'block';
    container.innerHTML = '<p>名簿を読み込み中...</p>';

    try {
        // GASから全員のデータを取得（action=getMemberList を使う）
        const response = await fetch(`${GAS_URL}?action=getMemberList`);
        const members = await response.json();

        container.innerHTML = ''; // 読み込み中メッセージを消す

        members.forEach(m => {
            const card = document.createElement('div');
            card.className = 'member-card';
            card.innerHTML = `
                <h4>${m.nickname || 'ななし'} (${m.name})</h4>
                <div class="member-info">
                    <p><b>期生:</b> ${m.gen}期生 / <b>生まれ年:</b> ${m.birthYear}年</p>
                    <p><b>バド歴:</b> ${m.exp}</p>
                    <p><b>趣味:</b> ${m.hobby}</p>
                    <p><b>好きな漫画:</b> ${m.manga}</p>
                    <p><b>愛用ラケット:</b> ${m.racket}</p>
                </div>
            `;
            container.appendChild(card);
        });

        // 名簿の場所まで自動でスクロール
        section.scrollIntoView({ behavior: 'smooth' });

    } catch (e) {
        container.innerHTML = '<p>名簿の読み込みに失敗しました。</p>';
        console.error(e);
    }
}
    </script>
</body>
</html>
