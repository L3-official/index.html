<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L3 Portal | Athletic Luxury</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;500;800&family=Shippori+Mincho:wght@700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        /* ğŸ’ åŸºæœ¬ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š */
        *, *::before, *::after { box-sizing: border-box; }
        :root { --l3-navy: #002b5b; --l3-lime: #e1ff00; --bg-body: #f8fafd; --text-main: #002b5b; --card-white: #ffffff; }
        
        body { background: var(--bg-body); color: var(--text-main); font-family: 'Outfit', sans-serif; margin: 0; padding-bottom: 140px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; -webkit-font-smoothing: antialiased; }
        
        /* ğŸ’ ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header-logo { width: 100%; padding: 55px 0 35px; display: flex; justify-content: center; background: #fff; margin-bottom: 25px; box-shadow: 0 4px 20px rgba(0,43,91,0.02); }
        .logo-img { width: 180px; height: auto; object-fit: contain; }

        .container { width: 92%; max-width: 380px; display: none; flex-direction: column; gap: 28px; position: relative; opacity: 0; }
        .container.active { display: flex; opacity: 1; }

        /* ğŸ’ ãƒ©ã‚°ã‚¸ãƒ¥ã‚¢ãƒªãƒ¼ãƒ»ã‚«ãƒ¼ãƒ‰ */
        .l3-card { 
            background: linear-gradient(145deg, #ffffff, #f9fbff); 
            border-radius: 40px; padding: 40px 30px; 
            box-shadow: 0 25px 50px rgba(0, 43, 91, 0.06), 0 0 0 1px rgba(0, 43, 91, 0.01); 
            text-align: center; width: 100%; position: relative; 
        }

        .lock-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); z-index: 100; display: none; align-items: center; justify-content: center; border-radius: 40px; }
        .lock-msg { background: var(--l3-navy); color: #fff; padding: 15px 25px; border-radius: 50px; font-size: 0.75rem; font-weight: 800; letter-spacing: 0.2em; }
        .locked .lock-overlay { display: flex; }
        
        .member-name { font-family: 'Shippori Mincho', serif; font-size: 2.5rem; margin: 15px 0; font-weight: 800; letter-spacing: 0.15em; color: var(--l3-navy); line-height: 1.1; }
        
        .glass-frame { fill: none; stroke: var(--l3-navy); stroke-width: 3; stroke-linecap: round; }
        .sand-fill { fill: var(--l3-lime); }

        .remain-val { font-size: 2.6rem; color: var(--l3-navy); font-weight: 800; letter-spacing: -0.02em; }

        /* ğŸ’ åç°¿ã‚°ãƒªãƒƒãƒ‰ */
        .list-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; }
        .member-item { background: #fff; border-radius: 28px; padding: 20px 15px; border: 1px solid rgba(0,43,91,0.04); text-align: center; overflow: hidden; box-shadow: 0 10px 30px rgba(0,43,91,0.02); cursor: pointer; transition: transform 0.2s; }
        .member-item.is-me { border: 2.5px solid var(--l3-navy); }
        .member-item.is-buddy { border: 2.5px solid var(--l3-lime); }

        .m-icon { width: 60px; height: 60px; background: #f0f4f8; border-radius: 50%; margin: 0 auto 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: 800; overflow: hidden; }
        .m-photo { width: 100%; height: 100%; object-fit: cover; }

        .detail-pane { display: none; margin-top: 20px; text-align: left; border-top: 1px solid rgba(0,0,0,0.05); padding-top: 20px; grid-template-columns: 1fr 1fr; gap: 20px 15px; }
        .member-item.expanded { grid-column: span 2; padding: 30px 20px; }
        .member-item.expanded .detail-pane { display: grid; }
        
        /* ğŸŸ¢ æƒ…ç·’çš„ã‚¢ã‚¤ã‚³ãƒ³ä»˜ããƒ©ãƒ™ãƒ« */
        .d-label { font-size: 0.55rem; color: #94a3b8; font-weight: 800; text-transform: uppercase; display: flex; align-items: center; gap: 5px; margin-bottom: 2px; }
        .d-label svg { width: 12px; height: 12px; fill: none; stroke: var(--l3-navy); stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .d-label .icon-lime { stroke: var(--l3-lime); }
        .d-val { font-size: 0.85rem; color: var(--l3-navy); font-weight: 800; word-break: break-all; }

        /* ğŸ’ ã‚¤ãƒ³ãƒ•ã‚©ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .accordion-item { background: #fff; border-radius: 25px; margin-bottom: 12px; overflow: hidden; border: 1px solid rgba(0,43,91,0.03); }
        .accordion-trigger { width: 100%; padding: 22px 25px; display: flex; align-items: center; justify-content: space-between; border: none; background: none; cursor: pointer; }
        .accordion-label { font-family: 'Shippori Mincho', serif; font-size: 1rem; font-weight: 800; color: var(--l3-navy); }
        .accordion-content { max-height: 0; overflow: hidden; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .accordion-inner { padding: 10px 25px 30px; font-size: 0.85rem; line-height: 1.8; color: rgba(0,43,91,0.7); }
        .info-link { color: var(--l3-navy); text-decoration: underline; font-weight: 800; word-break: break-all; }

        /* ğŸ’ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .nav { position: fixed; bottom: 35px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 400px; background: #01162d; border-radius: 35px; display: flex; justify-content: space-around; padding: 22px 0; box-shadow: 0 25px 60px rgba(0,0,0,0.3); z-index: 2000; }
        .nav-item { color: rgba(255,255,255,0.25); text-align: center; font-size: 8px; font-weight: 800; letter-spacing: 0.2em; text-transform: uppercase; cursor: pointer; }
        .nav-active { color: var(--l3-lime); }

        /* ğŸ’ å…±é€šãƒ‘ãƒ¼ãƒ„ */
        .btn-action { width: 100%; padding: 20px; border-radius: 24px; background: var(--l3-navy); color: #fff; font-weight: 800; border: none; cursor: pointer; }
        .stamp-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; }
        .slot { aspect-ratio: 1/1; background: #f9fafb; border-radius: 16px; border: 1px solid #f0f3f6; display: flex; align-items: center; justify-content: center; font-weight: 800; color: #dce3e9; }
        .slot.filled { background: var(--l3-navy); color: var(--l3-lime); border: none; }
    </style>
</head>
<body>

<header class="header-logo"><img src="https://i.postimg.cc/Hx0QpFkr/l3-logo-official-transparent.png" alt="L3 Logo" class="logo-img"></header>

<main class="container active" id="tab-mypage">
    <div class="lock-overlay"><div class="lock-msg">ä¼šå“¡é™å®šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã™</div></div>
    <div class="l3-card membership-card">
        <span style="font-size: 0.65rem; letter-spacing: 0.4em; opacity: 0.4; font-weight: 500;">L3 Official Member</span>
        <h2 id="display-name" class="member-name">---</h2>
        <div class="hourglass-visual" style="width:130px; height:160px; margin:30px auto;">
            <svg viewBox="0 0 100 160">
                <defs><path id="glassShape" d="M5,10 L95,10 C95,10 90,50 55,80 C90,110 95,150 95,150 L5,150 C5,150 10,110 45,80 C10,50 5,10 5,10 Z" /></defs>
                <use href="#glassShape" class="glass-frame" />
                <clipPath id="globalClip"><use href="#glassShape"/></clipPath>
                <g clip-path="url(#globalClip)">
                    <rect id="sand-top" class="sand-fill" x="5" y="10" width="90" height="0" />
                    <rect id="sand-bottom" class="sand-fill" x="5" y="150" width="90" height="0" />
                </g>
            </svg>
        </div>
        <div><div style="font-size: 0.65rem; opacity: 0.3; letter-spacing: 0.3em;">REMAINING</div><div id="display-days" class="remain-val">---<span style="font-size: 0.8rem; opacity: 0.4; margin-left: 5px;">DAYS</span></div></div>
    </div>
    <button onclick="takeAttendance()" class="btn-action" style="font-size: 1.1rem;">ğŸ“– å‡ºå¸­ç™»éŒ²</button>
    <div class="l3-card">
        <div style="font-size: 0.7rem; font-weight: 800; opacity: 0.3; letter-spacing: 0.3em; margin-bottom: 15px; text-transform: uppercase;">æœ¬æ—¥ã®ãƒãƒ‡ã‚£</div>
        <div id="buddy-display" style="font-family: 'Shippori Mincho', serif; font-size: 1.8rem; font-weight: 800; color: var(--l3-navy); margin-bottom: 20px;">---</div>
        <button id="btn-stamp" onclick="recordBuddyStamp()" style="display:none; width:100%; padding:16px; border-radius:16px; border:none; background:var(--l3-lime); color:var(--l3-navy); font-weight:800; cursor:pointer; margin-bottom: 25px;">äº¤æµã‚’è¨˜éŒ²ã™ã‚‹</button>
        <div id="stamp-root" class="stamp-grid"></div>
    </div>
    <div class="l3-card">
        <textarea id="feedback-comment" placeholder="é‹å–¶ã¸ã®ã”æ„è¦‹ç®±..." style="width:100%; min-height:100px; border-radius:20px; border:1px solid rgba(0,43,91,0.1); background:#f9fafb; padding:18px; margin-bottom:15px; outline:none; font-family: inherit; color: var(--l3-navy);"></textarea>
        <button onclick="sendFeedback()" class="btn-action">é€ä¿¡ã™ã‚‹</button>
    </div>
</main>

<main class="container" id="tab-list">
    <div class="lock-overlay"><div class="lock-msg">ä¼šå“¡é™å®šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã™</div></div>
    <div id="list-root" class="list-grid"></div>
</main>

<main class="container" id="tab-info"><div id="info-accordion-root"></div></main>

<nav class="nav">
    <div class="nav-item nav-active" id="nav-mypage" onclick="switchTab('mypage')">My Page</div>
    <div class="nav-item" id="nav-list" onclick="switchTab('list')">List</div>
    <div class="nav-item" id="nav-info" onclick="switchTab('info')">Info</div>
</nav>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycby21EhDYkN_Gjzad4ks8hsyquV61hhuI2VKylGAQwyYvpmvP1iZowqIaM6RdR64HVJeOA/exec";
    const LIFF_ID = "2008760618-igOldYtb"; 

    // ğŸŸ¢ ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ã‚ºãƒ»ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆMicro Graphicsï¼‰ã®å®šç¾©
    const ICONS = {
        nickname: `<svg viewBox="0 0 24 24"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 1 1-7.6-11.2h.1A10 10 0 0 1 21 11.5Z"/><path class="icon-lime" d="M16 11.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>`,
        experience: `<svg viewBox="0 0 24 24"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6m12 5h1.5a2.5 2.5 0 0 0 0-5H18M6 20h12V4H6v16Z"/><path class="icon-lime" d="M12 9v4m0 0 2-2m-2 2-2-2"/></svg>`,
        birth: `<svg viewBox="0 0 24 24"><path d="m12 2 3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2Z"/></svg>`,
        hobbies: `<svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78Z"/></svg>`,
        manga: `<svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20m-16 2.5A2.5 2.5 0 0 0 6.5 22H20V2h-13.5A2.5 2.5 0 0 0 4 4.5v15z"/><path class="icon-lime" d="M10 6h6m-6 4h6m-6 4h3"/></svg>`,
        racket: `<svg viewBox="0 0 24 24"><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5l6.74-6.76z"/><path class="icon-lime" d="M16 8l-2 2m-1-5 2 2m-8 8H5v-4"/></svg>`
    };

    async function loadPortal() {
        const urlParams = new URLSearchParams(window.location.search);
        let surfaceId = urlParams.get('id'); 
        const targetSection = urlParams.get('section');
        let realLineId = null;

        if (typeof liff !== 'undefined') {
            try {
                await liff.init({ liffId: LIFF_ID });
                if (!liff.isLoggedIn()) { liff.login(); return; }
                const profile = await liff.getProfile(); 
                realLineId = profile.userId; 
            } catch (err) { console.error("LIFFã‚¨ãƒ©ãƒ¼", err); }
        }

        let loginId = surfaceId || realLineId;

        // ğŸŸ¢ ã‚²ã‚¹ãƒˆè‡ªå‹•æ¡ˆå†…
        if (!loginId || loginId === "---") {
            document.getElementById('tab-mypage').classList.add('locked');
            document.getElementById('tab-list').classList.add('locked');
            switchTab('info'); 
            fetch(`${GAS_URL}?id=guest`).then(res => res.json()).then(data => renderInfo(data.infoData, targetSection));
            return; 
        }

        try {
            const res = await fetch(`${GAS_URL}?id=${loginId}`);
            const data = await res.json();
            if(data.status === "success") {
                if (surfaceId && realLineId && !data.isLinked) {
                    await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "link_real_id", surfaceId: surfaceId, realId: realLineId }) });
                }

                document.getElementById('display-name').innerText = data.userName;
                const diff = new Date(data.graduationDate) - new Date();
                const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
                document.getElementById('display-days').innerHTML = `${days}<span style="font-size:0.8rem; opacity:0.4; margin-left:5px;">DAYS</span>`;
                
                const ratio = Math.max(0, Math.min(1, (1 - (days / 1095))));
                gsap.to("#sand-top", { attr: { y: 10 + (70 * ratio), height: 70 * (1 - ratio) }, duration: 2.5 });
                gsap.to("#sand-bottom", { attr: { y: 150 - (70 * ratio), height: 70 * ratio }, duration: 2.5 });
                
                if (data.buddyName) { 
                    document.getElementById('buddy-display').innerText = data.buddyName; 
                    document.getElementById('btn-stamp').style.display = 'block'; 
                    window.currentBuddyId = data.buddyId; 
                }
                
                // ã‚¹ã‚¿ãƒ³ãƒ—æç”»
                const stampRoot = document.getElementById('stamp-root');
                stampRoot.innerHTML = '';
                for (let i = 0; i < 12; i++) {
                    const stamp = (data.stampHistory || [])[i];
                    const slot = document.createElement('div');
                    slot.className = 'slot' + (stamp ? ' filled' : '');
                    slot.innerText = stamp ? stamp.name.substring(0,1) : '';
                    stampRoot.appendChild(slot);
                }

                // ğŸŸ¢ åç°¿æç”»ï¼ˆä¸¦ã³æ›¿ãˆï¼šè‡ªåˆ†â†’ãƒãƒ‡ã‚£â†’ãã®ä»–ï¼‰
                if (data.allMembers) {
                    const me = data.allMembers.find(m => m.id === loginId || m.realId === loginId);
                    const buddy = data.allMembers.find(m => m.id === data.buddyId || m.realId === data.buddyId);
                    const others = data.allMembers.filter(m => m.id !== loginId && m.realId !== loginId && m.id !== data.buddyId && m.realId !== data.buddyId);
                    const sorted = [me, buddy, ...others].filter(Boolean);

                    const listRoot = document.getElementById('list-root');
                    listRoot.innerHTML = sorted.map(m => `
                        <div class="member-item ${m.id === loginId || m.realId === loginId ? 'is-me' : ''} ${m.id === data.buddyId || m.realId === data.buddyId ? 'is-buddy' : ''}" onclick="toggleMember(this)">
                            <div class="m-icon">${m.photo ? `<img src="${m.photo}" class="m-photo">` : m.name.substring(0,1)}</div>
                            <span class="m-name">${m.name}</span><span class="m-tag" style="font-size:0.55rem; opacity:0.3; font-weight:800; text-transform:uppercase; letter-spacing:0.1em; margin-top:2px;">${m.term}æœŸ</span>
                            <div class="detail-pane">
                                <div class="d-item"><span class="d-label">${ICONS.nickname} Nickname</span><span class="d-val">${m.nickname || "---"}</span></div>
                                <div class="d-item"><span class="d-label">${ICONS.experience} Experience</span><span class="d-val">${m.experience || "---"}</span></div>
                                <div class="d-item"><span class="d-label">${ICONS.birth} Birth Year</span><span class="d-val">${m.birthYear || "---"}</span></div>
                                <div class="d-item"><span class="d-label">${ICONS.hobbies} Hobbies</span><span class="d-val">${m.hobbies || "---"}</span></div>
                                <div class="d-item d-full"><span class="d-label">${ICONS.manga} Favorite Manga</span><span class="d-val">${m.manga || "---"}</span></div>
                                <div class="d-item d-full"><span class="d-label">${ICONS.racket} Racket</span><span class="d-val">${m.racket || "---"}</span></div>
                            </div>
                        </div>`).join('');
                }
                renderInfo(data.infoData, targetSection);
            }
        } catch (e) { }
    }
    
    // ğŸŸ¢ 403ã‚¨ãƒ©ãƒ¼é˜²æ­¢ãƒ­ã‚¸ãƒƒã‚¯æ­è¼‰ Infoæç”»
    function renderInfo(infoData, targetSection) {
        const infoRoot = document.getElementById('info-accordion-root');
        if(!infoData || infoData.length === 0) { infoRoot.innerHTML = '<p style="text-align:center; opacity:0.3; margin-top:40px;">ãŠçŸ¥ã‚‰ã›ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>'; return; }
        
        infoRoot.innerHTML = infoData.map(item => {
            let content = (item.content || "");
            const urlPattern = /((https?:\/\/|www\.)[^\s<"']+)/g;
            content = content.replace(urlPattern, (url) => {
                let href = url.startsWith('www.') ? 'https://' + url : url;
                href = href.replace(/[.,;]$/, ''); // 403é˜²æ­¢ï¼šæœ«å°¾ã®è¨˜å·ã‚’é™¤å»
                return `<a href="${href}" target="_blank" class="info-link">${url}</a>`;
            });

            const linkedContent = content.replace(/\n/g, '<br>');
            return `
                <div class="accordion-item" data-title="${item.title}">
                    <button class="accordion-trigger" onclick="toggleAccordion(this)"><span class="accordion-label">${item.title}</span><span style="font-size:0.8rem; opacity:0.3;">â–¼</span></button>
                    <div class="accordion-content"><div class="accordion-inner">${linkedContent}</div></div>
                </div>`;
        }).join('');

        // ç‰¹å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³è‡ªå‹•å±•é–‹ï¼ˆJOIN USãªã©ï¼‰
        if (targetSection === 'joinus' || window.location.search.includes('joinus')) {
            setTimeout(() => {
                const items = document.querySelectorAll('.accordion-item');
                items.forEach(item => { if (item.getAttribute('data-title').toUpperCase().includes('JOIN') || item.getAttribute('data-title').includes('å…¥ä¼š')) { toggleAccordion(item.querySelector('.accordion-trigger')); } });
            }, 500);
        }
    }

    // ğŸŸ¢ GSAP ã‚¹ã‚¿ãƒƒã‚¬ãƒ¼ãƒ»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    function switchTab(tab) {
        const activeContainer = document.querySelector('.container.active');
        if(activeContainer) {
            gsap.to(activeContainer, { opacity: 0, y: 10, duration: 0.3, onComplete: () => {
                activeContainer.classList.remove('active');
                performSwitch(tab);
            }});
        } else {
            performSwitch(tab);
        }
    }

    function performSwitch(tab) {
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('nav-active'));
        const nextContainer = document.getElementById('tab-' + tab);
        nextContainer.classList.add('active');
        document.getElementById('nav-' + tab).classList.add('nav-active');
        
        gsap.fromTo(nextContainer, { opacity: 0, y: 20 }, { opacity: 1, y: 0, duration: 0.5 });
        const children = nextContainer.querySelectorAll('.l3-card, .member-item, .accordion-item');
        if(children.length > 0) {
            gsap.from(children, { opacity: 0, y: 20, stagger: 0.08, duration: 0.6, ease: "power2.out" });
        }
    }

    function toggleMember(el) { 
        const isExpanded = el.classList.contains('expanded'); 
        document.querySelectorAll('.member-item').forEach(m => m.classList.remove('expanded')); 
        if (!isExpanded) { 
            el.classList.add('expanded'); 
            gsap.from(el.querySelector('.detail-pane'), { opacity: 0, y: -10, duration: 0.4 }); 
        } 
    }
    
    function toggleAccordion(el) {
        const item = el.parentElement; const content = item.querySelector('.accordion-content'); const isActive = item.classList.contains('active');
        document.querySelectorAll('.accordion-item').forEach(i => { i.classList.remove('active'); i.querySelector('.accordion-content').style.maxHeight = null; });
        if (!isActive) { item.classList.add('active'); content.style.maxHeight = content.scrollHeight + "px"; }
    }
    
    async function takeAttendance() { const id = new URLSearchParams(window.location.search).get('id') || (await liff.getProfile()).userId; try { const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "attendance", userId: id }) }); if((await res.json()).status === "success") { alert("å‡ºå¸­ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼ğŸ“–"); } } catch (e) { } }
    async function recordBuddyStamp() { const id = new URLSearchParams(window.location.search).get('id') || (await liff.getProfile()).userId; try { const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "buddy_stamp", userId: id, buddyId: window.currentBuddyId }) }); if((await res.json()).status === "success") { alert("äº¤æµã‚’è¨˜éŒ²ã—ã¾ã—ãŸï¼ğŸ”¥"); } } catch (e) { } }
    async function sendFeedback() {
        const comment = document.getElementById('feedback-comment').value;
        if(!comment || !confirm("é€ä¿¡ã—ã¾ã™ã‹ï¼Ÿ")) return;
        const id = new URLSearchParams(window.location.search).get('id') || (await liff.getProfile()).userId;
        try {
            const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "feedback", userId: id, comment: comment }) });
            if((await res.json()).status === "success") { alert("é€ä¿¡å®Œäº†ã—ã¾ã—ãŸï¼"); document.getElementById('feedback-comment').value = ''; }
        } catch (e) { }
    }
    loadPortal();
</script>
</body>
</html>
