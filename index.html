<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L3 Portal | Athletic Luxury</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;500;800&family=Shippori+Mincho:wght@700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        *, *::before, *::after { box-sizing: border-box; }
        :root {
            --l3-navy: #002b5b; --l3-lime: #e1ff00; --bg-body: #f8fafd;
            --text-main: #002b5b; --card-white: #ffffff;
        }
        body {
            background: var(--bg-body); color: var(--text-main); font-family: 'Outfit', sans-serif;
            margin: 0; padding-bottom: 140px; display: flex; flex-direction: column; align-items: center; min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }
        .header-logo { width: 100%; padding: 55px 0 35px; display: flex; justify-content: center; background: #fff; margin-bottom: 25px; }
        .logo-img { width: 180px; height: auto; object-fit: contain; }
        .container { width: 92%; max-width: 380px; display: none; flex-direction: column; gap: 28px; position: relative; }
        .container.active { display: flex; }
        .l3-card { background: var(--card-white); border-radius: 40px; padding: 40px 30px; box-shadow: 0 20px 50px rgba(0, 43, 91, 0.04); border: 1px solid rgba(0, 43, 91, 0.02); text-align: center; width: 100%; position: relative; }
        
        /* ğŸ”’ ãƒ­ãƒƒã‚¯æ¼”å‡º */
        .lock-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); z-index: 100; display: none; align-items: center; justify-content: center; border-radius: 40px; }
        .lock-msg { background: var(--l3-navy); color: #fff; padding: 15px 25px; border-radius: 50px; font-size: 0.75rem; font-weight: 800; letter-spacing: 0.2em; }
        .locked .lock-overlay { display: flex; }
        .locked > *:not(.lock-overlay) { pointer-events: none; }

        /* MY PAGE ãƒ‡ã‚¶ã‚¤ãƒ³å›ºå®š */
        .membership-card { border-top: 1px solid rgba(0, 43, 91, 0.1); }
        .member-status { font-size: 0.65rem; letter-spacing: 0.4em; font-weight: 500; opacity: 0.4; margin-bottom: 20px; display: block; text-transform: uppercase; }
        .member-name { font-family: 'Shippori Mincho', serif; font-size: 2.5rem; margin: 15px 0; font-weight: 800; letter-spacing: 0.15em; color: var(--l3-navy); line-height: 1.1; }
        .hourglass-visual { position: relative; width: 130px; height: 160px; margin: 30px auto; }
        .hourglass-svg { width: 100%; height: 100%; }
        .glass-frame { fill: none; stroke: var(--l3-navy); stroke-width: 3; stroke-linecap: round; stroke-linejoin: round; }
        .sand-fill { fill: var(--l3-lime); }
        .sand-grain { fill: var(--l3-lime); opacity: 0.6; }
        .remain-label { font-size: 0.65rem; font-weight: 500; opacity: 0.3; letter-spacing: 0.3em; margin-bottom: 5px; }
        .remain-val { font-size: 2.6rem; color: var(--l3-navy); font-weight: 800; letter-spacing: -0.02em; }
        .remain-unit { font-size: 0.8rem; font-weight: 500; opacity: 0.4; letter-spacing: 0.1em; margin-left: 5px;}
        .btn-attendance { width: 100%; padding: 22px; border-radius: 24px; background: var(--l3-navy); color: #fff; font-weight: 800; font-size: 1.1rem; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 12px; transition: transform 0.1s; }
        .btn-attendance:active { transform: scale(0.96); }

        .buddy-label { font-size: 0.7rem; font-weight: 800; opacity: 0.3; letter-spacing: 0.3em; text-transform: uppercase; margin-bottom: 15px; }
        .buddy-name-display { font-family: 'Shippori Mincho', serif; font-size: 1.8rem; font-weight: 800; color: var(--l3-navy); margin-bottom: 20px; }
        .stamp-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-top: 25px; }
        .slot { aspect-ratio: 1/1; background: #f9fafb; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 1rem; font-weight: 700; color: #dce3e9; border: 1px solid #f0f3f6; }
        .slot.filled { background: var(--l3-navy); color: var(--l3-lime); border: none; }
        
        /* ã”æ„è¦‹ç®±å¾©å…ƒ */
        .feedback-area { width: 100%; min-height: 100px; border-radius: 20px; border: 1px solid rgba(0, 43, 91, 0.1); background: #f9fafb; padding: 18px; font-family: inherit; font-size: 0.95rem; color: var(--l3-navy); resize: none; margin-bottom: 15px; outline: none; display: block; }
        
        .btn-edit-trigger { background: transparent; color: var(--l3-navy); border: 1px solid var(--l3-navy); padding: 12px; border-radius: 15px; font-size: 0.65rem; font-weight: 800; letter-spacing: 0.2em; cursor: pointer; width: 100%; margin-top: 15px; }
        
        #edit-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,43,91,0.4); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); z-index: 3000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal-card { background: #fff; width: 100%; max-width: 360px; border-radius: 40px; padding: 40px 30px; text-align: center; }
        .btn-save { width: 100%; padding: 18px; border-radius: 20px; background: var(--l3-navy); color: #fff; font-weight: 800; border: none; margin-top: 20px; cursor: pointer; display: block; }
        .btn-cancel { width: 100%; background: transparent; color: var(--l3-navy); opacity: 0.4; font-size: 0.7rem; font-weight: 800; border: none; margin-top: 15px; cursor: pointer; display: block; }

        /* LIST ãƒ‡ã‚¶ã‚¤ãƒ³å›ºå®š */
        .list-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; }
        .member-item { background: #fff; border-radius: 28px; padding: 20px 15px; border: 1px solid rgba(0,43,91,0.04); text-align: center; transition: all 0.3s; }
        .member-item.is-me { border: 2.5px solid var(--l3-navy); }
        .member-item.is-buddy { border: 2.5px solid var(--l3-lime); }
        .m-icon { width: 60px; height: 60px; background: #f0f4f8; border-radius: 50%; margin: 0 auto 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: 800; overflow: hidden; }
        .m-photo { width: 100%; height: 100%; object-fit: cover; }
        .m-name { font-family: 'Shippori Mincho', serif; font-size: 0.95rem; font-weight: 800; color: var(--l3-navy); display: block; }
        .m-tag { font-size: 0.55rem; font-weight: 800; opacity: 0.3; letter-spacing: 0.1em; margin-top: 5px; display: block; }
        .detail-pane { display: none; margin-top: 20px; text-align: left; border-top: 1px solid rgba(0,0,0,0.05); padding-top: 15px; grid-template-columns: 1fr 1fr; gap: 15px; }
        .member-item.expanded { grid-column: span 2; padding: 30px 20px; }
        .member-item.expanded .detail-pane { display: grid; }

        /* ğŸ›ï¸ INFOã‚¿ãƒ–ï¼šã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .info-header-area { text-align: center; margin-bottom: 20px; }
        .info-main-title { font-family: 'Shippori Mincho', serif; font-size: 1.6rem; font-weight: 800; color: var(--l3-navy); margin-bottom: 5px; }
        .info-sub-title { font-size: 0.6rem; font-weight: 800; opacity: 0.3; letter-spacing: 0.4em; text-transform: uppercase; }
        
        .accordion-item { background: #fff; border-radius: 25px; margin-bottom: 12px; overflow: hidden; border: 1px solid rgba(0,43,91,0.03); box-shadow: 0 10px 30px rgba(0,43,91,0.02); }
        .accordion-trigger { width: 100%; padding: 22px 25px; display: flex; align-items: center; justify-content: space-between; background: none; border: none; cursor: pointer; text-align: left; }
        .accordion-label { font-family: 'Shippori Mincho', serif; font-size: 1rem; font-weight: 800; color: var(--l3-navy); display: flex; align-items: center; gap: 12px; }
        .accordion-icon { width: 24px; height: 24px; background: #f0f4f8; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; color: var(--l3-navy); transition: transform 0.3s; }
        .accordion-item.active .accordion-icon { transform: rotate(180deg); background: var(--l3-navy); color: var(--l3-lime); }
        .accordion-content { max-height: 0; overflow: hidden; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); background: #fcfdfe; }
        .accordion-inner { padding: 10px 25px 30px; font-size: 0.85rem; line-height: 1.8; color: var(--l3-navy); opacity: 0.8; }
        .info-highlight { color: var(--l3-navy); font-weight: 800; border-bottom: 2px solid var(--l3-lime); }

        .nav { position: fixed; bottom: 35px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 400px; background: #01162d; border-radius: 35px; display: flex; justify-content: space-around; padding: 22px 0; box-shadow: 0 25px 60px rgba(0,0,0,0.2); z-index: 2000; }
        .nav-item { color: rgba(255,255,255,0.25); text-align: center; font-size: 8px; font-weight: 800; text-decoration: none; letter-spacing: 0.2em; text-transform: uppercase; cursor: pointer; }
        .nav-active { color: var(--l3-lime); opacity: 1; }
    </style>
</head>
<body>

<header class="header-logo">
    <img src="https://i.postimg.cc/Hx0QpFkr/l3-logo-official-transparent.png" alt="L3 Logo" class="logo-img">
</header>

<main class="container active" id="tab-mypage">
    <div class="lock-overlay"><div class="lock-msg">ä¼šå“¡é™å®šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã™</div></div>
    <div class="l3-card membership-card">
        <span class="member-status">L3 Official Member</span>
        <h2 id="display-name" class="member-name">---</h2>
        <div class="hourglass-visual">
            <svg class="hourglass-svg" viewBox="0 0 100 160">
                <defs>
                    <path id="glassShape" d="M5,10 L95,10 C95,10 90,50 55,80 C90,110 95,150 95,150 L5,150 C5,150 10,110 45,80 C10,50 5,10 5,10 Z" />
                    <clipPath id="globalClip"><use href="#glassShape"/></clipPath>
                </defs>
                <use href="#glassShape" class="glass-frame" />
                <g clip-path="url(#globalClip)">
                    <rect id="sand-top" class="sand-fill" x="5" y="10" width="90" height="0" />
                    <rect id="sand-bottom" class="sand-fill" x="5" y="150" width="90" height="0" />
                    <circle id="sand-stream" class="sand-grain" cx="50" cy="80" r="1.5" style="display:none;"/>
                </g>
            </svg>
        </div>
        <div style="margin-top:25px;">
            <div class="remain-label">REMAINING</div>
            <div id="display-days" class="remain-val">---<span class="remain-unit">DAYS</span></div>
        </div>
    </div>
    <button onclick="takeAttendance()" class="btn-attendance">ğŸ“– å‡ºå¸­ç™»éŒ²</button>
    <div class="l3-card">
        <div class="buddy-label">æœ¬æ—¥ã®ãƒãƒ‡ã‚£</div>
        <div id="buddy-display" class="buddy-name-display">---</div>
        <button id="btn-stamp" onclick="recordBuddyStamp()" style="display:none; margin-bottom:15px; width:100%; padding:16px; border-radius:16px; border:none; background:var(--l3-lime); color:var(--l3-navy); font-weight:800; cursor:pointer;">äº¤æµã‚’è¨˜éŒ²ã™ã‚‹</button>
        <div class="buddy-label" style="margin-top:20px; margin-bottom:10px;">BUDDY COLLECTION</div>
        <div id="stamp-root" class="stamp-grid"></div>
    </div>
    <div class="l3-card">
        <div class="buddy-label">é‹å–¶ã¸ã®ã”æ„è¦‹ç®±</div>
        <textarea id="feedback-comment" class="feedback-area" placeholder="è¦æœ›ã‚„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
        <button onclick="sendFeedback()" style="width:100%; padding:16px; border-radius:18px; background:var(--l3-navy); color:#fff; font-weight:800; border:none; cursor:pointer;">é€ä¿¡ã™ã‚‹</button>
    </div>
</main>

<main class="container" id="tab-list">
    <div class="lock-overlay"><div class="lock-msg">ä¼šå“¡é™å®šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã™</div></div>
    <div style="text-align:center; margin-bottom:10px;"><span style="font-size:0.7rem; font-weight:800; letter-spacing:0.4em; opacity:0.3;">MEMBER LIST</span></div>
    <div id="list-root" class="list-grid"></div>
</main>

<main class="container" id="tab-info">
    <div class="info-header-area">
        <h1 class="info-main-title">L3 Guide</h1>
        <p class="info-sub-title">Information & Rules</p>
    </div>

    <div class="accordion-item">
        <button class="accordion-trigger" onclick="toggleAccordion(this)">
            <span class="accordion-label">ğŸ›ï¸ L3 Philosophy</span>
            <span class="accordion-icon">â–¼</span>
        </button>
        <div class="accordion-content">
            <div class="accordion-inner">
                é«˜æ´¥ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³ã‚µãƒ¼ã‚¯ãƒ« L3ã®æ ¸å¿ƒã¯<span class="info-highlight">ã€Œ3å¹´ã§ç‡ƒãˆå°½ãã‚‹ã€</span>ã¨ã„ã†åˆ¹é‚£çš„ãªç¾å­¦ã«ã‚ã‚Šã¾ã™ã€‚<br>
                é™ã‚‰ã‚ŒãŸæ™‚é–“ã ã‹ã‚‰ã“ãã€ä¸€å›ä¸€å›ã®ç·´ç¿’ã‚’æœ€é«˜ã«ç†±ãã€æ¿ƒå¯†ãªã‚‚ã®ã«ã™ã‚‹ã€‚å’æ¥­ãŒã‚ã‚‹ã‹ã‚‰ã“ãã€ä»Šã“ã®ç¬é–“ã®äº¤æµã‚’å¤§åˆ‡ã«ã™ã‚‹ã€‚ãã‚ŒãŒL3ã®å“²å­¦ã§ã™ã€‚
            </div>
        </div>
    </div>

    <div class="accordion-item">
        <button class="accordion-trigger" onclick="toggleAccordion(this)">
            <span class="accordion-label">âœ‰ï¸ ä»£è¡¨æŒ¨æ‹¶</span>
            <span class="accordion-icon">â–¼</span>
        </button>
        <div class="accordion-content">
            <div class="accordion-inner">
                L3ãƒãƒ¼ã‚¿ãƒ«ã¸ã‚ˆã†ã“ãã€‚ä»£è¡¨ã®å’Œç”°ã§ã™ã€‚<br>
                ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³ã‚’é€šã˜ã¦ã€å˜ãªã‚‹ã‚¹ãƒãƒ¼ãƒ„ä»¥ä¸Šã®ã€Œè³ªã®é«˜ã„ä½“é¨“ã€ã‚’å…±æœ‰ã—ãŸã„ã€‚ãã‚“ãªæƒ³ã„ã§ã“ã®ã‚µãƒ¼ã‚¯ãƒ«ã‚’ç«‹ã¡ä¸Šã’ã¾ã—ãŸã€‚å…±ã«æœ€é«˜ã®3å¹´é–“ã‚’ä½œã‚Šä¸Šã’ã¾ã—ã‚‡ã†ã€‚
            </div>
        </div>
    </div>

    <div class="accordion-item">
        <button class="accordion-trigger" onclick="toggleAccordion(this)">
            <span class="accordion-label">ğŸ’ L3 Value</span>
            <span class="accordion-icon">â–¼</span>
        </button>
        <div class="accordion-content">
            <div class="accordion-inner">
                L3ãŒæä¾›ã™ã‚‹ã®ã¯<span class="info-highlight">ã€ŒAthletic Luxuryã€</span>ãªä½“é¨“ã§ã™ã€‚<br>
                å¦¥å”ã®ãªã„ç«¶æŠ€ãƒ¬ãƒ™ãƒ«ã®è¿½æ±‚ã¨ã€æ´—ç·´ã•ã‚ŒãŸå¤§äººã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®ä¸¡ç«‹ã€‚ã“ã®ãƒãƒ¼ã‚¿ãƒ«ã‚’é€šã˜ãŸã€Œãƒãƒ‡ã‚£åˆ¶åº¦ã€ã‚„ã€Œãƒ‡ã‚¸ã‚¿ãƒ«ä¼šå“¡è¨¼ã€ã‚‚ã€ãã®ç‰¹åˆ¥ãªä½“é¨“ã®ä¸€éƒ¨ã§ã™ã€‚
            </div>
        </div>
    </div>

    <div class="accordion-item">
        <button class="accordion-trigger" onclick="toggleAccordion(this)">
            <span class="accordion-label">ğŸ¸ æ´»å‹•æ¦‚è¦</span>
            <span class="accordion-icon">â–¼</span>
        </button>
        <div class="accordion-content">
            <div class="accordion-inner">
                â–  æ´»å‹•é »åº¦ï¼šæ¯é€±åœŸæ—¥ãƒ»ç¥æ—¥ã‚’ä¸­å¿ƒã¨ã—ãŸæœˆæ•°å›<br>
                â–  å†…å®¹ï¼šåŸºç¤æ‰“ã¡ã€ã‚²ãƒ¼ãƒ ç·´ç¿’ã€éƒ¨å†…ãƒªãƒ¼ã‚°æˆ¦<br>
                â–  ä½¿ç”¨çƒï¼šç¬¬ä¸€ç¨®æ¤œå®šåˆæ ¼çƒï¼ˆYONEX NEW OFFICIALç­‰ï¼‰
            </div>
        </div>
    </div>

    <div class="accordion-item">
        <button class="accordion-trigger" onclick="toggleAccordion(this)">
            <span class="accordion-label">ğŸ“ ã‚¢ã‚¯ã‚»ã‚¹</span>
            <span class="accordion-icon">â–¼</span>
        </button>
        <div class="accordion-content">
            <div class="accordion-inner">
                ä¸»ã«å·å´å¸‚é«˜æ´¥åŒºå†…ã®å…¬å…±æ–½è¨­ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚<br><br>
                â–  <span class="info-highlight">é«˜æ´¥ã‚¹ãƒãƒ¼ãƒ„ã‚»ãƒ³ã‚¿ãƒ¼</span><br>æ±æ€¥ç”°åœ’éƒ½å¸‚ç·šã€ŒäºŒå­æ–°åœ°é§…ã€ã‚ˆã‚Šå¾’æ­©8åˆ†<br>
                â–  <span class="info-highlight">å·å´å¸‚æ°‘ãƒ—ãƒ©ã‚¶</span><br>å¸‚ãƒã‚¹ã€Œå¸‚æ°‘ãƒ—ãƒ©ã‚¶ã€ä¸‹è»Šã™ã
            </div>
        </div>
    </div>

    <div class="accordion-item">
        <button class="accordion-trigger" onclick="toggleAccordion(this)">
            <span class="accordion-label">âš–ï¸ Rules & Manners</span>
            <span class="accordion-icon">â–¼</span>
        </button>
        <div class="accordion-content">
            <div class="accordion-inner">
                ãƒ»æº–å‚™ã€ç‰‡ä»˜ã‘ã¯å…¨å“¡ã§ç‡å…ˆã—ã¦è¡Œã†ã“ã¨ã€‚<br>
                ãƒ»ãƒ‰ã‚¿ã‚­ãƒ£ãƒ³ã¯é‹å–¶ã¨ãƒ¡ãƒ³ãƒãƒ¼ã¸ã®ãƒªã‚¹ãƒšã‚¯ãƒˆã‚’æ¬ ãè¡Œç‚ºã¨ã¿ãªã—ã€å³æ ¼ã«å¯¾å¿œã—ã¾ã™ã€‚<br>
                ãƒ»<span class="info-highlight">ã€Œå¿…ãš3å¹´å¾Œã«å¼•é€€ã€</span>ã®ãƒ«ãƒ¼ãƒ«ã‚’å³å®ˆã—ã€å…¨åŠ›ã‚’å‡ºã—åˆ‡ã‚‹ã“ã¨ã€‚
            </div>
        </div>
    </div>

    <div class="accordion-item">
        <button class="accordion-trigger" onclick="toggleAccordion(this)">
            <span class="accordion-label">ğŸ“± Buddy & Portal</span>
            <span class="accordion-icon">â–¼</span>
        </button>
        <div class="accordion-content">
            <div class="accordion-inner">
                æœ¬ãƒãƒ¼ã‚¿ãƒ«ã§ã¯æ¯å›ã€Œæœ¬æ—¥ã®ãƒãƒ‡ã‚£ã€ãŒæŒ‡å®šã•ã‚Œã¾ã™ã€‚<br>
                ç·´ç¿’ä¸­ã®ãƒšã‚¢ãƒªãƒ³ã‚°ã‚„äº¤æµã‚’æ·±ã‚ã€<span class="info-highlight">ã€Œäº¤æµã‚’è¨˜éŒ²ã™ã‚‹ã€</span>ãƒœã‚¿ãƒ³ã§ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è²¯ã‚ã¦ãã ã•ã„ã€‚åç°¿ã®ã€ŒPROFILE EDITã€ã‹ã‚‰ã‚¢ã‚¤ã‚³ãƒ³è¨­å®šã‚‚å¯èƒ½ã§ã™ã€‚
            </div>
        </div>
    </div>

    <div class="accordion-item">
        <button class="accordion-trigger" onclick="toggleAccordion(this)">
            <span class="accordion-label">ğŸ’° ä¼šè²»åˆ¶åº¦</span>
            <span class="accordion-icon">â–¼</span>
        </button>
        <div class="accordion-content">
            <div class="accordion-inner">
                â–  å…¥ä¼šé‡‘ï¼šÂ¥X,XXX<br>
                â–  ç·´ç¿’å‚åŠ è²»ï¼šÂ¥X,XXX / å›ï¼ˆã‚·ãƒ£ãƒˆãƒ«ãƒ»ã‚³ãƒ¼ãƒˆä»£è¾¼ï¼‰<br>
                ä¼šè²»ã¯ã™ã¹ã¦ã‚³ãƒ¼ãƒˆç¢ºä¿ã€æ¶ˆè€—å“ã€ãƒãƒ¼ã‚¿ãƒ«ç¶­æŒã€ã‚¤ãƒ™ãƒ³ãƒˆé‹å–¶ã«å……ã¦ã‚‰ã‚Œã¾ã™ã€‚
            </div>
        </div>
    </div>

    <div class="accordion-item">
        <button class="accordion-trigger" onclick="toggleAccordion(this)">
            <span class="accordion-label">ğŸ¤ Join Us</span>
            <span class="accordion-icon">â–¼</span>
        </button>
        <div class="accordion-content">
            <div class="accordion-inner">
                L3ã¯å®Œå…¨æ‹›å¾…ãƒ»ç´¹ä»‹åˆ¶ã‚’åŸºæœ¬ã¨ã—ã¦ã„ã¾ã™ãŒã€ç†±æ„ã‚ã‚‹æ–¹ã®ä½“é¨“å‚åŠ ã‚‚å—ã‘ä»˜ã‘ã¦ã„ã¾ã™ã€‚<br>
                å…¥ä¼šæ¡ä»¶ï¼šãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³çµŒé¨“è€…ã§ã‚ã‚Šã€L3ã®ãƒ•ã‚£ãƒ­ã‚½ãƒ•ã‚£ãƒ¼ã«æ·±ãå…±æ„Ÿã§ãã‚‹æ–¹ã€‚
            </div>
        </div>
    </div>

    <div class="accordion-item">
        <button class="accordion-trigger" onclick="toggleAccordion(this)">
            <span class="accordion-label">â“ FAQ</span>
            <span class="accordion-icon">â–¼</span>
        </button>
        <div class="accordion-content">
            <div class="accordion-inner">
                Q. 3å¹´çµŒã£ãŸã‚‰çµ¶å¯¾ã«è¾ã‚ãªã„ã¨ã„ã‘ãªã„ï¼Ÿ<br>
                A. ã¯ã„ã€‚ãã‚ŒãŒL3ã®èª‡ã‚Šã§ã‚ã‚Šã€ãƒ«ãƒ¼ãƒ«ã§ã™ã€‚å¼•é€€å¾Œã¯ã€Œå’æ¥­ç”Ÿã€ã¨ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆã¸æ‹›å¾…ã•ã‚Œã¾ã™ã€‚<br><br>
                Q. åˆå¿ƒè€…ã§ã‚‚å¤§ä¸ˆå¤«ï¼Ÿ<br>
                A. ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ãŒã€ç¾åœ¨ã¯ç«¶æŠ€ã®è³ªã‚’ä¿ã¤ãŸã‚ã€ä¸€å®šä»¥ä¸Šã®çµŒé¨“è€…ã®ã¿ã‚’å‹Ÿé›†ã—ã¦ã„ã¾ã™ã€‚
            </div>
        </div>
    </div>

    <div class="accordion-item">
        <button class="accordion-trigger" onclick="toggleAccordion(this)">
            <span class="accordion-label">ğŸ›¡ï¸ Safety & Privacy</span>
            <span class="accordion-icon">â–¼</span>
        </button>
        <div class="accordion-content">
            <div class="accordion-inner">
                â–  ã‚¹ãƒãƒ¼ãƒ„ä¿é™ºã¸ã®åŠ å…¥ã‚’å¼·ãæ¨å¥¨ã—ã¾ã™ã€‚<br>
                â–  ãƒãƒ¼ã‚¿ãƒ«ã«å…¥åŠ›ã•ã‚ŒãŸå€‹äººæƒ…å ±ã¯ã€ã‚µãƒ¼ã‚¯ãƒ«é‹å–¶ä»¥å¤–ã®ç›®çš„ã§ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ¡ãƒ³ãƒãƒ¼é–“ã®ç›¸äº’å°Šé‡ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚
            </div>
        </div>
    </div>
</main>

<div id="edit-modal">
    <div class="modal-card">
        <div class="modal-title">Edit Profile</div>
        <div class="form-group"><label class="form-label">ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒURL</label><input type="text" id="edit-photo" class="form-input" placeholder="https://..."></div>
        <div class="form-group"><label class="form-label">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </label><input type="text" id="edit-nickname" class="form-input"></div>
        <div class="form-group"><label class="form-label">ç”Ÿã¾ã‚Œå¹´</label><input type="number" id="edit-birthYear" class="form-input"></div>
        <div class="form-group"><label class="form-label">ãƒãƒ‰æ­´</label><input type="text" id="edit-experience" class="form-input"></div>
        <div class="form-group"><label class="form-label">æ„›ç”¨ãƒ©ã‚±ãƒƒãƒˆ</label><input type="text" id="edit-racket" class="form-input"></div>
        <div class="form-group"><label class="form-label">è¶£å‘³ãƒ»ãƒã‚¤ãƒ–ãƒ¼ãƒ </label><input type="text" id="edit-hobbies" class="form-input"></div>
        <div class="form-group"><label class="form-label">å¥½ããªæ¼«ç”»ãƒ»ã‚¢ãƒ‹ãƒ¡</label><input type="text" id="edit-manga" class="form-input"></div>
        <button onclick="saveProfile()" class="btn-save">ä¿å­˜ã—ã¦è‡ªåˆ†ã‚’æ›´æ–°ã™ã‚‹</button>
        <button onclick="closeEditModal()" class="btn-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </div>
</div>

<nav class="nav">
    <div class="nav-item nav-active" id="nav-mypage" onclick="switchTab('mypage')">My Page</div>
    <div class="nav-item" id="nav-list" onclick="switchTab('list')">List</div>
    <div class="nav-item" id="nav-info" onclick="switchTab('info')">Info</div>
</nav>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycby21EhDYkN_Gjzad4ks8hsyquV61hhuI2VKylGAQwyYvpmvP1iZowqIaM6RdR64HVJeOA/exec";
    let currentUserData = null;

    async function loadPortal() {
        const id = new URLSearchParams(window.location.search).get('id');
        if (!id || id === "---") {
            document.getElementById('tab-mypage').classList.add('locked');
            document.getElementById('tab-list').classList.add('locked');
            return; 
        }
        try {
            const res = await fetch(`${GAS_URL}?id=${id}`);
            const data = await res.json();
            if(data.status === "success") {
                currentUserData = data.allMembers.find(m => m.id === id);
                document.getElementById('display-name').innerText = data.userName;
                const diff = new Date(data.graduationDate) - new Date();
                const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
                document.getElementById('display-days').innerHTML = `${days}<span class="remain-unit">DAYS</span>`;
                
                const progressRatio = Math.max(0, Math.min(1, (1 - (days / 1095))));
                gsap.to("#sand-top", { attr: { y: 10 + (70 * progressRatio), height: 70 * (1 - progressRatio) }, duration: 2.5, ease: "power2.out" });
                gsap.to("#sand-bottom", { attr: { y: 150 - (70 * progressRatio), height: 70 * progressRatio }, duration: 2.5, ease: "power2.out" });

                const stream = document.getElementById('sand-stream');
                stream.style.display = 'block';
                gsap.to(stream, { y: 65, duration: 0.8, repeat: -1, ease: "none", opacity: 0 });

                if (data.buddyName) {
                    document.getElementById('buddy-display').innerText = data.buddyName;
                    document.getElementById('btn-stamp').style.display = 'block';
                    window.currentBuddyId = data.buddyId;
                }
                
                const stampRoot = document.getElementById('stamp-root');
                stampRoot.innerHTML = '';
                for (let i = 0; i < 12; i++) {
                    const stamp = (data.stampHistory || [])[i];
                    const slot = document.createElement('div');
                    slot.className = 'slot' + (stamp ? ' filled' : '');
                    slot.innerText = stamp ? stamp.name.substring(0,1) : '';
                    stampRoot.appendChild(slot);
                }

                if (data.allMembers) {
                    const listRoot = document.getElementById('list-root');
                    const sorted = [...data.allMembers].sort((a, b) => {
                        if (a.id === id) return -1;
                        if (b.id === id) return 1;
                        if (a.id === data.buddyId) return -1;
                        if (b.id === data.buddyId) return 1;
                        return a.name.localeCompare(b.name, 'ja');
                    });
                    listRoot.innerHTML = sorted.map(m => `
                        <div class="member-item ${m.id === id ? 'is-me' : ''} ${m.id === data.buddyId ? 'is-buddy' : ''}" onclick="toggleMember(this)">
                            <div class="m-icon">${m.photo ? `<img src="${m.photo}" class="m-photo">` : m.name.substring(0,1)}</div>
                            <span class="m-name">${m.name}</span>
                            <span class="m-tag">${m.id === id ? 'YOU / ' + m.term + 'æœŸ' : (m.id === data.buddyId ? 'BUDDY / ' + m.term + 'æœŸ' : m.term + 'æœŸ')}</span>
                            <div class="detail-pane">
                                <div class="d-item"><span class="d-label">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </span><span class="d-val">${m.nickname || "---"}</span></div>
                                <div class="d-item"><span class="d-label">ç”Ÿã¾ã‚Œå¹´</span><span class="d-val">${m.birthYear || "---"}å¹´</span></div>
                                <div class="d-item"><span class="d-label">ãƒãƒ‰æ­´</span><span class="d-val">${m.experience || "---"}</span></div>
                                <div class="d-item"><span class="d-label">æ„›ç”¨ãƒ©ã‚±ãƒƒãƒˆ</span><span class="d-val">${m.racket || "---"}</span></div>
                                <div class="d-item d-full"><span class="d-label">è¶£å‘³ãƒ»ãƒã‚¤ãƒ–ãƒ¼ãƒ </span><span class="d-val">${m.hobbies || "---"}</span></div>
                                <div class="d-item d-full"><span class="d-label">å¥½ããªæ¼«ç”»ãƒ»ã‚¢ãƒ‹ãƒ¡</span><span class="d-val">${m.manga || "---"}</span></div>
                                ${m.id === id ? `<div class="d-full"><button onclick="event.stopPropagation(); openEditModal();" class="btn-edit-trigger">PROFILE EDIT</button></div>` : ''}
                            </div>
                        </div>
                    `).join('');
                }
            }
        } catch (e) { }
    }

    function switchTab(tab) {
        gsap.fromTo(".container.active", { opacity: 1, y: 0 }, { opacity: 0, y: 10, duration: 0.3, onComplete: () => {
            document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('nav-active'));
            document.getElementById('tab-' + tab).classList.add('active');
            document.getElementById('nav-' + tab).classList.add('nav-active');
            gsap.fromTo("#tab-" + tab, { opacity: 0, y: 20 }, { opacity: 1, y: 0, duration: 0.5 });
        }});
    }

    function toggleAccordion(el) {
        const item = el.parentElement;
        const content = item.querySelector('.accordion-content');
        const isActive = item.classList.contains('active');
        document.querySelectorAll('.accordion-item').forEach(i => {
            i.classList.remove('active');
            i.querySelector('.accordion-content').style.maxHeight = null;
        });
        if (!isActive) {
            item.classList.add('active');
            content.style.maxHeight = content.scrollHeight + "px";
        }
    }

    function toggleMember(el) {
        const isExpanded = el.classList.contains('expanded');
        document.querySelectorAll('.member-item').forEach(m => m.classList.remove('expanded'));
        if (!isExpanded) { el.classList.add('expanded'); gsap.from(el.querySelector('.detail-pane'), { opacity: 0, y: -10, duration: 0.4 }); }
    }
    function openEditModal() {
        if(!currentUserData) return;
        document.getElementById('edit-photo').value = currentUserData.photo || "";
        document.getElementById('edit-nickname').value = currentUserData.nickname || "";
        document.getElementById('edit-birthYear').value = currentUserData.birthYear || "";
        document.getElementById('edit-experience').value = currentUserData.experience || "";
        document.getElementById('edit-racket').value = currentUserData.racket || "";
        document.getElementById('edit-hobbies').value = currentUserData.hobbies || "";
        document.getElementById('edit-manga').value = currentUserData.manga || "";
        document.getElementById('edit-modal').style.display = 'flex';
        gsap.from(".modal-card", { scale: 0.8, opacity: 0, duration: 0.4, ease: "back.out(1.7)" });
    }
    function closeEditModal() { gsap.to(".modal-card", { scale: 0.8, opacity: 0, duration: 0.3, onComplete: () => { document.getElementById('edit-modal').style.display = 'none'; }}); }
    async function saveProfile() {
        const id = new URLSearchParams(window.location.search).get('id');
        try {
            const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "update_profile", userId: id, photo: document.getElementById('edit-photo').value, nickname: document.getElementById('edit-nickname').value, birthYear: document.getElementById('edit-birthYear').value, experience: document.getElementById('edit-experience').value, racket: document.getElementById('edit-racket').value, hobbies: document.getElementById('edit-hobbies').value, manga: document.getElementById('edit-manga').value }) });
            if((await res.json()).status === "success") { alert("ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼ğŸ“¸"); closeEditModal(); loadPortal(); }
        } catch (e) { }
    }
    async function takeAttendance() {
        const id = new URLSearchParams(window.location.search).get('id');
        try {
            const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "attendance", userId: id }) });
            if((await res.json()).status === "success") { alert("å‡ºå¸­ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼ğŸ“–"); loadPortal(); }
        } catch (e) { }
    }
    async function recordBuddyStamp() {
        const id = new URLSearchParams(window.location.search).get('id');
        try {
            const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "buddy_stamp", userId: id, buddyId: window.currentBuddyId }) });
            if((await res.json()).status === "success") { alert("äº¤æµã‚’è¨˜éŒ²ã—ã¾ã—ãŸï¼ğŸ”¥"); loadPortal(); }
        } catch (e) { }
    }
    async function sendFeedback() {
        const comment = document.getElementById('feedback-comment').value;
        if(!comment || !confirm("é€ä¿¡ã—ã¾ã™ã‹ï¼Ÿ")) return;
        const id = new URLSearchParams(window.location.search).get('id');
        try {
            const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "feedback", userId: id, comment: comment }) });
            if((await res.json()).status === "success") { alert("é€ä¿¡å®Œäº†ã—ã¾ã—ãŸï¼"); document.getElementById('feedback-comment').value = ''; }
        } catch (e) { }
    }
    loadPortal();
</script>
</body>
</html>
